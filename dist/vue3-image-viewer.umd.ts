(function(n,g){typeof exports=="object"&&typeof module<"u"?module.exports=g(require("vue")):typeof define=="function"&&define.amd?define(["vue"],g):(n=typeof globalThis<"u"?globalThis:n||self,n["vue3-image-viewer"]=g(n.Vue))})(this,function(n){"use strict";const g=typeof window>"u",b=function(){return g?function(e,t,i){e&&t&&i&&e.attachEvent("on"+t,i)}:function(e,t,i){e&&t&&i&&e.addEventListener(t,i,!1)}}(),p=function(){return g?function(e,t,i){e&&t&&e.detachEvent("on"+t,i)}:function(e,t,i){e&&t&&e.removeEventListener(t,i,!1)}}(),D=function(){return!g&&!!window.navigator.userAgent.match(/firefox/i)};function I(e){let t=!1;return function(...i){t||(t=!0,window.requestAnimationFrame(o=>{e.apply(this,i),t=!1}))}}function S(e){const t=new Image;t.setAttribute("crossOrigin","anonymous"),t.onload=function(){const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const o=i.getContext("2d");o==null||o.drawImage(t,0,0,t.width,t.height);const f=i.toDataURL("image/png"),w=document.createElement("a"),a=new MouseEvent("click"),u=e.split("/"),k=u[u.length-1];w.download=k||"img",w.href=f,w.dispatchEvent(a)},t.src=e}const Z="",z=n.defineComponent({name:"ImageViewer",props:{curIndex:{type:Number,default:0},images:{type:Array,default:[]},showDownload:{type:Boolean,default:!1},showThumbnail:{type:Boolean,default:!1},handlePosition:{type:String,default:"bottom"},onClose:{type:Function,default:Function},onDownload:{type:Function,default:Function},zIndex:{type:Number,default:2e3},maskBgColor:{type:String,default:"rgba(0,0,0,0.5)"}},setup(e){const t={CONTAIN:{name:"contain",icon:"icon-full-screen"},ORIGINAL:{name:"original",icon:"icon-c-scale-to-original"}},i=D()?"DOMMouseScroll":"mousewheel",o=n.reactive({mode:t.CONTAIN,visible:!1,curIndex:0,isMouseEnterThumbnail:!1,thumbnailTransitionShow:!1,transform:{scale:1,deg:0,rotateY:0,offsetX:0,offsetY:0,enableTransition:!1},dragHandler:()=>{},keyDownHandler:s=>{},mouseWheelHandler:()=>{}}),f=n.ref(),w=n.computed(()=>e.handlePosition=="bottom"?{top:"10px",bottom:"auto"}:{bottom:"10px",top:"auto"}),a=n.computed(()=>e.handlePosition=="bottom"?{bottom:e.showThumbnail&&e.images&&e.images.length>1?"100px":"30px",top:"auto"}:{top:"30px",bottom:"auto"}),u=n.computed(()=>{const{scale:s,deg:l,rotateY:c,offsetX:d,offsetY:r,enableTransition:m}=o.transform,C={transform:`scale(${s}) rotate(${l}deg) rotateY(${c}deg)`,transition:m?"transform .3s":"","margin-left":`${d}px`,"margin-top":`${r}px`,maxWidth:"",maxHeight:""};return o.mode.name===t.CONTAIN.name&&(C.maxWidth=C.maxHeight="100%"),C}),k=n.computed(()=>o.curIndex===0),x=n.computed(()=>o.curIndex===e.images.length-1),P=s=>{o.isMouseEnterThumbnail=s},y=s=>{if(!e.showThumbnail)return;o.curIndex=s;let l=f.value;if(!l)return;let c=l.clientWidth,d=l.scrollLeft,r=l.children[s].offsetLeft;c-r<160?c-r<0&&d===0?l.scrollLeft=r-c+160:l.scrollLeft=d+80:r-d<80&&(l.scrollLeft=r-120)},j=s=>{if(s.button!==0)return;const{offsetX:l,offsetY:c}=o.transform,d=s.pageX,r=s.pageY;o.dragHandler=I(m=>{o.transform.offsetX=l+m.pageX-d,o.transform.offsetY=c+m.pageY-r}),b(document,"mousemove",o.dragHandler),b(document,"mouseup",()=>{p(document,"mousemove",o.dragHandler)}),s.preventDefault()},N=()=>{if(k.value)return;const s=e.images.length;o.curIndex=(o.curIndex-1+s)%s,y(o.curIndex)},T=()=>{if(x.value)return;const s=e.images.length;o.curIndex=(o.curIndex+1)%s,y(o.curIndex)},U=()=>{o.keyDownHandler=s=>{switch(s.preventDefault(),s.keyCode){case 17:h("mirror");break;case 18:h("clockwise");break;case 27:E();break;case 32:V();break;case 37:N();break;case 38:h("zoomIn");break;case 39:T();break;case 40:h("zoomOut");break}},o.mouseWheelHandler=I(s=>{const l=s.wheelDelta?s.wheelDelta:-s.detail;if(o.isMouseEnterThumbnail){let c=-1,d=1,r=0;r=l>0?c*50:d*50,f.value&&(f.value.scrollLeft=f.value.scrollLeft+r)}else l>0?h("zoomIn",{zoomRate:.015,enableTransition:!1}):h("zoomOut",{zoomRate:.015,enableTransition:!1})}),b(document,"keydown",o.keyDownHandler),b(document,i,o.mouseWheelHandler)},G=()=>{p(document,"keydown",o.keyDownHandler),p(document,i,o.mouseWheelHandler),o.keyDownHandler=s=>{},o.mouseWheelHandler=()=>{}},h=(s,l={})=>{const{zoomRate:c,rotateDeg:d,enableTransition:r}={zoomRate:.2,rotateDeg:90,enableTransition:!0,...l},{transform:m}=o;switch(s){case"zoomOut":m.scale>.2&&(m.scale=parseFloat((m.scale-c).toFixed(3)));break;case"zoomIn":m.scale=parseFloat((m.scale+c).toFixed(3));break;case"clockwise":m.deg+=d;break;case"anticlockwise":m.deg-=d;break;case"mirror":m.rotateY+=180;break}m.enableTransition=r},J=()=>{o.transform={scale:1,deg:0,rotateY:0,offsetX:0,offsetY:0,enableTransition:!1}},V=()=>{const s=Object.keys(t),l=Object.values(t),d=(l.findIndex(r=>r.name==o.mode.name)+1)%s.length;o.mode=l[d],J()},K=()=>{var s;S(e.images[o.curIndex]),(s=e.onDownload)==null||s.call(e,e.images[o.curIndex])},Q=()=>{E()},E=()=>{var s;(s=e.onClose)==null||s.call(e),G(),o.visible=!1,o.thumbnailTransitionShow=!1};return n.onMounted(()=>{o.curIndex=e.curIndex,U(),o.visible=!0,n.nextTick(()=>{o.thumbnailTransitionShow=!0})}),{...n.toRefs(o),close:E,handleTapClose:Q,pre:N,next:T,thumbnailRef:f,imgStyle:u,handleMouseDown:j,sequenceStyle:w,actionStyle:a,handleActions:h,download:K,toggleMode:V,change:y,mouseEnterThumbnail:P}}}),ee="",$=(e,t)=>{const i=e.__vccOpts||e;for(const[o,f]of t)i[o]=f;return i},B=[n.createElementVNode("i",{class:"iconfont icon-close"},null,-1)],_=[n.createElementVNode("i",{class:"iconfont icon-arrow-left"},null,-1)],M=[n.createElementVNode("i",{class:"iconfont icon-arrow-right"},null,-1)],F={class:"tmd-image-viewer__image"},H=["src"],A={class:"tmd-image-viewer_actions__inner"},L=n.createElementVNode("span",{class:"tmd-image-viewer__actions__divider"},null,-1),O=n.createElementVNode("span",{class:"tmd-image-viewer__actions__divider"},null,-1),Y=n.createElementVNode("span",{class:"tmd-image-viewer__actions__divider"},null,-1),v=["onClick"],R=["src"];function W(e,t,i,o,f,w){return n.openBlock(),n.createBlock(n.Transition,{name:"viewer-fade"},{default:n.withCtx(()=>[n.withDirectives(n.createElementVNode("div",{tabindex:"-1",class:"tmd-image-viewer__wrapper",style:n.normalizeStyle(`z-index:${e.zIndex}`)},[n.createElementVNode("div",{class:"tmd-image-viewer__mask",style:n.normalizeStyle(`background-color:${e.maskBgColor};`),onClick:t[0]||(t[0]=(...a)=>e.handleTapClose&&e.handleTapClose(...a))},null,4),n.createElementVNode("span",{class:"tmd-image-viewer__btn tmd-image-viewer__close",onClick:t[1]||(t[1]=(...a)=>e.close&&e.close(...a))},B),e.images&&e.images.length>1?(n.openBlock(),n.createElementBlock("span",{key:0,class:"tmd-image-viewer__btn tmd-image-viewer__pre",onClick:t[2]||(t[2]=(...a)=>e.pre&&e.pre(...a))},_)):n.createCommentVNode("",!0),e.images&&e.images.length>1?(n.openBlock(),n.createElementBlock("span",{key:1,class:"tmd-image-viewer__btn tmd-image-viewer__next",onClick:t[3]||(t[3]=(...a)=>e.next&&e.next(...a))},M)):n.createCommentVNode("",!0),n.createElementVNode("div",F,[n.withDirectives(n.createElementVNode("img",{src:e.images[e.curIndex],style:n.normalizeStyle(e.imgStyle),onMousedown:t[4]||(t[4]=(...a)=>e.handleMouseDown&&e.handleMouseDown(...a))},null,44,H),[[n.vShow,e.images&&e.images.length>0&&e.images[e.curIndex]]])]),n.createElementVNode("div",{class:"tmd-image-viewer__actions",style:n.normalizeStyle(e.actionStyle)},[n.createElementVNode("div",A,[n.createElementVNode("span",{class:"iconfont icon-zoom-out",onClick:t[5]||(t[5]=a=>e.handleActions("zoomOut"))}),n.createElementVNode("span",{class:"iconfont icon-zoom-in",onClick:t[6]||(t[6]=a=>e.handleActions("zoomIn"))}),L,n.createElementVNode("span",{class:"iconfont icon-refresh-left",onClick:t[7]||(t[7]=a=>e.handleActions("anticlockwise"))}),n.createElementVNode("span",{class:"iconfont icon-refresh-right",onClick:t[8]||(t[8]=a=>e.handleActions("clockwise"))}),n.createElementVNode("span",{class:"iconfont icon-mirror",onClick:t[9]||(t[9]=a=>e.handleActions("mirror"))}),O,n.createElementVNode("span",{class:n.normalizeClass(["iconfont",e.mode.icon]),onClick:t[10]||(t[10]=(...a)=>e.toggleMode&&e.toggleMode(...a))},null,2),e.showDownload?(n.openBlock(),n.createElementBlock(n.Fragment,{key:0},[Y,n.createElementVNode("span",{class:"iconfont icon-download",onClick:t[11]||(t[11]=(...a)=>e.download&&e.download(...a))})],64)):n.createCommentVNode("",!0)])],4),n.createVNode(n.Transition,{name:"thumbnail-fade",onAfterEnter:t[14]||(t[14]=a=>e.change(e.curIndex))},{default:n.withCtx(()=>[n.withDirectives(n.createElementVNode("div",{class:"tmd-image-viewer__thumbnail",ref:"thumbnailRef",onMouseenter:t[12]||(t[12]=a=>e.mouseEnterThumbnail(!0)),onMouseleave:t[13]||(t[13]=a=>e.mouseEnterThumbnail(!1))},[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(e.images,(a,u)=>(n.openBlock(),n.createElementBlock("div",{class:n.normalizeClass(["tmd-image-viewer__thumbnail__inner",{current:e.curIndex===u}]),key:a+"_thumbnail_"+u,onClick:k=>e.change(u)},[n.createElementVNode("img",{src:a},null,8,R)],10,v))),128))],544),[[n.vShow,e.thumbnailTransitionShow&&e.showThumbnail&&e.images&&e.images.length>1]])]),_:1}),n.withDirectives(n.createElementVNode("span",{class:"tmd-image-viewer__sequence",style:n.normalizeStyle(e.sequenceStyle)},n.toDisplayString(e.curIndex+1)+" / "+n.toDisplayString(e.images.length),5),[[n.vShow,!e.showThumbnail]])],4),[[n.vShow,e.visible]])]),_:1})}const X=$(z,[["render",W]]),q={curIndex:0,images:[],showDownload:!1,showThumbnail:!1,handlePosition:"bottom",onClose:Function,onDownload:Function,zIndex:2e3,maskBgColor:"rgba(0,0,0,0.5)"};return e=>{const t=document.createElement("div");t.className="tmd-image-viewer-container";const i={...q,...e,onClose:e.onClose||null,onDownload:e.onDownload||null},o=n.createVNode(X,i);o&&o.props&&(o.props.onDestroy=()=>{setTimeout(()=>{n.render(null,t)},300)}),n.render(o,t),t.firstElementChild&&document.body.appendChild(t.firstElementChild)}});
